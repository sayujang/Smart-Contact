<!DOCTYPE html>
<html lang="en" th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}">

<head>
    <title th:text="${loginUser.name}+' | View Contacts'"></title>
    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .animate-slide-in {
            animation: slideIn 0.4s ease-out;
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in-out;
        }

        .contact-row {
            transition: all 0.3s ease;
        }

        .contact-row:hover {
            transform: translateX(4px);
        }

        .action-btn {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.1;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .action-btn:hover::before {
            width: 100px;
            height: 100px;
        }

        .search-container {
            position: relative;
            transition: all 0.3s ease;
        }

        .search-container:focus-within {
            transform: scale(1.02);
        }

        .profile-img {
            transition: transform 0.3s ease;
        }

        .contact-row:hover .profile-img {
            transform: scale(1.1);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .dark .table-header {
            background: linear-gradient(135deg, #4c51bf 0%, #553c9a 100%);
        }

        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.8);
        }

        .dark .glass-effect {
            background: rgba(31, 41, 55, 0.8);
        }

        .link-icon {
            transition: all 0.2s ease;
        }

        .link-icon:hover {
            transform: scale(1.2) rotate(5deg);
        }

        #search-type {
            min-width: 110px;
        }

        #search-type:hover {
            background-color: rgba(168, 85, 247, 0.05);
        }

        button[type="submit"]:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .search-container form {
                flex-wrap: wrap;
            }
        }
    </style>
</head>

<body>
    <div id="content">
        <input type="hidden" id="loggedInUserId" th:value="${loginUser.userId}">
        <!-- if user if logged in show sidebar -->
        <div th:if="${loginUser}">
            <div th:replace="~{user/sidebar::sidebar}"></div>
        </div>
        <div class="sm:pl-64 pt-20">
            <div class="flex items-center justify-center md:pt-32 flex-col px-4">
                <!-- Header Section -->
                <div class="animate-fade-in mb-8 text-center">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-800 dark:text-white mb-2">
                        My Contacts
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400 text-lg">Manage and organize your connections</p>
                </div>

                <div class="w-full max-w-7xl animate-slide-in">
                    <div
                        class="relative overflow-hidden shadow-2xl rounded-2xl border border-gray-200 dark:border-gray-700">
                        <div class="glass-effect p-6 border-b border-gray-200 dark:border-gray-700">
                            <div
                                class="flex items-center justify-between flex-column flex-wrap md:flex-row space-y-4 md:space-y-0">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 
                rounded-xl flex items-center justify-center shadow-lg
                border border-black/20 dark:border-white/30">
                                        <i class="fa-solid fa-address-book text-black dark:text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Contact List
                                        </h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">All your saved contacts</p>
                                    </div>
                                </div>
                                <div
                                    class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-600">
                                    <i class="fa-solid fa-users text-purple-600 dark:text-purple-400"></i>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">
                                        <span
                                            th:unless="${contactSearchForm.query != null and !contactSearchForm.query.isEmpty()}">
                                            Total Contacts: <span class="font-bold"
                                                th:text="${pageContact.totalElements}">0</span>
                                        </span>
                                    </p>
                                </div>
                                <div th:replace="~{message::messagebox}"></div>
                                <!-- Search Section -->
                                <div class="search-container">
                                    <form th:action="@{'/user/contact/search'}" th:object="${contactSearchForm}"
                                        method="get" class="flex items-center gap-2">
                                        <div class="relative">
                                            <select th:field="*{searchType}" name="searchType" id="search-type" class="block p-3 pr-10 text-sm text-gray-900 border-2 border-gray-300 rounded-l-xl bg-white 
                        focus:ring-2 focus:ring-purple-500 focus:border-purple-500 
                        dark:bg-gray-800 dark:border-gray-600 dark:text-white 
                        dark:focus:ring-purple-500 dark:focus:border-purple-500 
                        shadow-sm cursor-pointer appearance-none
                        transition-all duration-200 hover:border-purple-400">
                                                <option value="name">Name</option>
                                                <option value="email">Email</option>
                                                <option value="phone">Phone</option>
                                            </select>
                                            <div
                                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                                <i
                                                    class="fa-solid fa-chevron-down text-gray-500 dark:text-gray-400 text-xs"></i>
                                            </div>
                                        </div>

                                        <div class="relative flex-1 max-w-sm">
                                            <input type="text" th:field="*{query}" name="query" id="search-input" class="block w-full p-3 pr-28 text-sm text-gray-900 border border-gray-300 rounded-xl
    bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 
    dark:bg-gray-800 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white 
    dark:focus:ring-purple-500 dark:focus:border-purple-500 shadow-sm transition-all duration-200"
                                                placeholder="Search contacts...">

                                            <button type="submit" class="absolute inset-y-0 right-2 my-auto px-4 py-1.5 text-sm font-semibold text-gray-800 
    bg-gradient-to-r from-gray-100 to-gray-200 border border-gray-300 rounded-lg
    hover:from-purple-600 hover:to-pink-600 hover:text-black
    focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 
    dark:bg-gradient-to-r dark:from-gray-700 dark:to-gray-800 dark:text-gray-200 
    dark:border-gray-600 dark:hover:from-purple-700 dark:hover:to-pink-700
    shadow-md hover:shadow-lg transform hover:-translate-y-0.5 
    transition-all duration-200 flex items-center gap-2">
                                                <i class="fa-solid fa-search"></i>
                                                <span>Search</span>
                                            </button>
                                        </div>

                                        <a href="/user/contact"
                                            class="p-3 px-4 text-sm font-medium text-gray-700 dark:text-gray-300 
                    bg-gray-100 dark:bg-gray-700 rounded-xl 
                    hover:bg-gray-200 dark:hover:bg-gray-600 
                    focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600
                    shadow-sm hover:shadow-md transform hover:-translate-y-0.5
                    transition-all duration-200 flex items-center justify-center dark:border-gray-600 border-gray-300 border"
                                            title="Clear search">
                                            <i class="fa-solid fa-rotate-right"></i>
                                        </a>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Table Section -->
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left rtl:text-right">
                                <thead class="text-xs uppercase table-header text-black dark:text-white">
                                    <tr>
                                        <th scope="col" class="px-6 py-4 font-semibold tracking-wider">
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-user"></i>
                                                <span>Contact Info</span>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-4 font-semibold tracking-wider">
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-phone"></i>
                                                <span>Phone</span>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-4 font-semibold tracking-wider">
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-link"></i>
                                                <span>Links</span>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-4 font-semibold tracking-wider">
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-gear"></i>
                                                <span>Actions</span>
                                            </div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr th:each="c : ${pageContact.content}" th:object="${c}"
                                        class="contact-row bg-white dark:bg-gray-800 hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 dark:hover:from-gray-700 dark:hover:to-gray-700">
                                        <th scope="row" class="px-6 py-5">
                                            <div class="flex items-center gap-4">
                                                <div class="relative">
                                                    <img th:src="@{*{picture}}"
                                                        class="profile-img w-12 h-12 rounded-full object-cover border-2 border-purple-400 shadow-md"
                                                        onerror="this.src='/images/user.png'">

                                                    <div th:if="*{favorite}"
                                                        class="absolute -top-1 -right-1 text-yellow-400 text-sm drop-shadow-sm">
                                                        <i class="fa-solid fa-star"></i>
                                                    </div>

                                                    <div class="user-status-dot absolute bottom-0 right-0 w-3.5 h-3.5 bg-gray-400 border-2 border-white dark:border-gray-800 rounded-full"
                                                        th:data-email="*{email}" title="Offline">
                                                    </div>
                                                </div>
                                                <div>
                                                    <div th:text="*{name}"
                                                        class="text-base font-semibold text-gray-900 dark:text-white mb-1">
                                                        Neil Sims
                                                    </div>
                                                    <div th:text="*{email}"
                                                        class="font-normal text-gray-500 dark:text-gray-400 text-sm flex items-center gap-1">
                                                        <i class="fa-solid fa-envelope text-xs"></i>
                                                        neil.sims@flowbite.com
                                                    </div>
                                                </div>
                                            </div>
                                        </th>
                                        <td class="px-6 py-5">
                                            <div class="flex items-center gap-2 text-gray-900 dark:text-gray-300">
                                                <div
                                                    class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                                                    <i
                                                        class="fa-solid fa-phone text-green-600 dark:text-green-400 text-sm"></i>
                                                </div>
                                                <span th:text="*{phoneNumber}" class="font-medium">+1234567890</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-5">
                                            <div class="flex items-center gap-3">
                                                <a th:if="*{websiteLink != null and !#strings.isEmpty(websiteLink)}"
                                                    th:href="@{*{websiteLink}}" target="_blank"
                                                    class="link-icon w-9 h-9 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center hover:bg-green-200 dark:hover:bg-green-800 group">
                                                    <i class="fa-solid fa-link text-green-600 dark:text-green-400"></i>
                                                </a>
                                                <a th:if="*{linkedInLink != null and !#strings.isEmpty(linkedInLink)}"
                                                    th:href="@{*{linkedInLink}}" target="_blank"
                                                    class="link-icon w-9 h-9 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center hover:bg-blue-200 dark:hover:bg-blue-800 group">
                                                    <i
                                                        class="fa-brands fa-linkedin text-blue-600 dark:text-blue-400"></i>
                                                </a>
                                            </div>
                                        </td>
                                        <td class="px-6 py-5">
                                            <div class="flex gap-2">
                                                <!-- Delete Button -->
                                                <button th:onclick="deleteContact([[${c.id}]])"
                                                    class="action-btn w-9 h-9 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center hover:bg-red-200 dark:hover:bg-red-800 text-red-600 dark:text-red-400"
                                                    title="Delete contact">
                                                    <i class="fa-solid fa-trash"></i>
                                                </button>

                                                <!-- Edit Button -->
                                                <a th:href="@{'/user/contact/update_view/'+*{id}}"
                                                    class="action-btn w-9 h-9 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center hover:bg-blue-200 dark:hover:bg-blue-800 text-blue-600 dark:text-blue-400"
                                                    title="Edit contact">
                                                    <i class="fa-solid fa-pen"></i>
                                                </a>

                                                <!-- View Button -->
                                                <button th:onclick="loadContactData([[${c.id}]])"
                                                    class="action-btn w-9 h-9 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-400"
                                                    title="View details">
                                                    <i class="fa-solid fa-eye"></i>
                                                </button>

                                                <!-- Chat Button -->
                                                <button
                                                    th:attr="data-email=*{email},data-name=*{name},data-contact-id=*{id}"
                                                    onclick="openChatModal(this.getAttribute('data-email'), this.getAttribute('data-name'), this.getAttribute('data-contact-id'))"
                                                    class="action-btn w-9 h-9 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center hover:bg-green-200 dark:hover:bg-green-800 text-green-600 dark:text-green-400"
                                                    title="Start chat">
                                                    <i class="fa-solid fa-comment"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination Section (keeping your existing pagination) -->
                        <div data-th-if="${pageContact.totalElements>0}"
                            class="p-6 text-center border-t border-gray-200 dark:border-gray-700 bg-gradient-to-b from-gray-50 to-white dark:from-gray-800 dark:to-gray-900">
                            <nav aria-label="Page navigation example">
                                <ul class="inline-flex -space-x-px text-base h-11 shadow-md rounded-xl overflow-hidden">
                                    <li data-th-unless="${pageContact.first}">
                                        <a data-th-href="@{'/user/contact?size='+${pageSize}+'&page=' + ${pageContact.number-1}}"
                                            href="#" class="flex items-center justify-center px-5 h-11 leading-tight 
                           text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 
                           hover:bg-purple-100 dark:hover:bg-purple-600/30 hover:text-purple-700 dark:hover:text-purple-300 
                           transition-colors duration-200 font-medium rounded-l-xl">
                                            <i class="fa-solid fa-chevron-left mr-2"></i>Previous
                                        </a>
                                    </li>
                                    <li data-th-each="index : ${#numbers.sequence(0,pageContact.totalPages-1)}">
                                        <a data-th-href="@{'/user/contact?size='+${pageSize}+'&page='+${index}}"
                                            href="#"
                                            data-th-classappend="${index==pageContact.number? 
                        'bg-purple-100 text-purple-700 border-gray-300 dark:bg-purple-600 dark:text-white dark:border-purple-500 rounded-md ring-1 ring-purple-300 dark:ring-0 shadow-sm' : 
                        'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:bg-purple-50 dark:hover:bg-purple-600/30 hover:text-purple-700 dark:hover:text-purple-300'}"
                                            class="flex items-center justify-center px-4 h-11 leading-tight border font-medium transition-colors duration-200">
                                            <span data-th-text="${index+1}">1</span>
                                        </a>
                                    </li>
                                    <li data-th-unless="${pageContact.last}">
                                        <a data-th-href="@{'/user/contact?size='+${pageSize}+'&page=' + ${pageContact.number+1}}"
                                            href="#" class="flex items-center justify-center px-5 h-11 leading-tight 
                           text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 
                           hover:bg-purple-100 dark:hover:bg-purple-600/30 hover:text-purple-700 dark:hover:text-purple-300 
                           transition-colors duration-200 font-medium rounded-r-xl">
                                            Next<i class="fa-solid fa-chevron-right ml-2"></i>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <!-- No Results Section -->
                        <div class="glass-effect p-16 text-center" data-th-if="${pageContact.totalElements<=0}">
                            <div class="max-w-md mx-auto">
                                <div class="w-24 h-24 bg-gradient-to-br from-purple-500 to-pink-500 
           rounded-full mx-auto mb-6 flex items-center justify-center shadow-xl
           border border-black/20 dark:border-white/30">
                                    <i class="fa-solid fa-address-book text-black dark:text-white text-4xl"></i>
                                </div>
                                <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-3">
                                    No Contacts Found
                                </h1>
                                <p class="text-gray-600 dark:text-gray-400 text-lg">
                                    Start adding contacts to see them here
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Modal (your existing modal) -->
            <div th:replace="~{user/contact_modal::contact_modal}"></div>

            <!-- Chat Modal (NEW) -->
            <div th:replace="~{chat_modal :: body}"></div>
        </div>
    </div>

    <!-- WebSocket Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <!-- Your existing scripts -->
    <script th:src="@{/js/contact.js}"></script>

    <!-- Chat script (NEW) -->
    <script th:src="@{/js/chat.js}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchType = document.getElementById('search-type');
            const searchInput = document.getElementById('search-input');

            const placeholders = {
                name: 'Search by name...',
                email: 'Search by email...',
                phone: 'Search by phone number...'
            };

            searchInput.placeholder = placeholders[searchType.value] || 'Search contacts...';

            searchType.addEventListener('change', function () {
                searchInput.placeholder = placeholders[this.value] || 'Search contacts...';
            });
        });
    </script>
</body>

</html>